(rr-code-reuse)=
# 再利用可能なコード
ソフトウェアプロジェクトは、データ処理に使用する小さなスクリプトから、データ分析に使用するノートブックまでの範囲があります。 アルゴリズムを実装したソフトウエアライブラリです ソフトウェアプロジェクトの大きさや小ささにかかわらず、コードを再利用可能にすることが重要です。

ソフトウェアの種類によって、再利用可能な要件が異なります: 小さなスクリプトの場合。 十分なドキュメントを持っているだけで十分かもしれませんが、ミッションクリティカルなソフトウェアライブラリでは徹底的なテストが必要かもしれません。 最も基本的なレベルでは、コードをオンラインに入れるだけで長く続く可能性があります。 研究ソフトウェアをより再利用可能にするためのより精巧なアプローチは、研究ソフトウェアのためのFAIR原則(FAIRS原則) {cite:ps}`ChueHong2021FAIR4RS` に従うことです。

コードを再利用可能にすることについて話すとき、私たちが何を意味するのかを明確にすることが有用です。 {ref}`再現性の定義表<rr-overview-definitions-reproducibility>` では、同じデータと同じコードを使用する再現性のある研究を定義しました。 しかしながら、コードの再利用については多くの形式を取ることができます。まったく同じコードを実行したい場合があります(コンパイルされたプログラミング言語の場合)。 全く同じバイナリファイルを意味するかもしれません) あるいはソースコードを変更して我々のニーズに合うように拡張したいかもしれません Freire and Chirigati {cite:ps}`Freire2018Reproductibility` は、変更できるものに応じて、異なるレベルの再現性の枠組みを提供します。 再現性、再実行可能、ポータブル、拡張可能、変更可能な次のレベルを定義します。

再現性のある定義をFreireフレームワークに以下のようにマッピングすることができます。

| Freire framework | 再現性の定義                                   |
| ---------------- | ---------------------------------------- |
| 繰り返し可能           | 再現可能 (同じデータ、同じ分析)                        |
| 再実行              | 堅牢な & Replicable (同じコード、異なるデータ/分析/パラメータ) |
| Portable         | *考慮されていない* (同じコード/データ、異なる環境)             |
| 拡張可能             | (部分的に) 一般化可能                             |
| 変更可能             | (部分的に) 一般化可能                             |

移植性は以前は考慮されていませんでしたが、ソフトウェアの環境が異なります (異なるハードウェアなど)。 オペレーティングシステム、あるいは同等のハードウェアに新しくインストールした場合でも、ソフトウェアの動作に影響を及ぼす可能性があります(例えば依存関係に影響を及ぼす可能性があります)。

また、Generalisable は 2 つの概念をカプセル化します: Extendable (他のソフトウェアと統合する能力) と Modifiable (その機能を拡張するために実装の一部を変更する能力)。

この章の残りの部分では、あなたのコードが再利用可能であることを確認するために、おすすめのリストを提供します。

(rr-code-reuse-recommendation-checklist)=
## コードをより再利用できるようにする方法
このセクションには、ソフトウェアをより再利用可能にするための推奨事項のチェックリストが含まれています。
{ref}`rr-code-reuse-recommendation-details` セクションには、これらのレコメンデーションの詳細な説明が含まれています。 あなたのソフトウェアのタイプに適した推奨事項に従い、あなたの場合には関連しないものをスキップすることができます。

### 繰り返し推奨事項
1. 確認してください (スペースで)
1. 見つけられることを確認してください（時間内）
1. 同じ一連の操作を実行できることを確認してください
1. あなたの環境と一連の操作が堅牢であることを確認してください。何が行われたかを再現するために人間は必要ありません。
1. コードをライセンスしてください
    - 再利用を可能にするライセンスを持っています
    - 依存関係のライセンスと互換性のあるライセンス
1. 引用可能であることを確認してください
1. 必要なデータを含める
1. 便利なドキュメントを書く*

### 再実行可能な推奨事項
1. ハードコードされたビットを削除し、コードをモジュール化する
1. 作成したモジュールは、さまざまな種類の入力データまたはパラメータを取ることができることをテストします
1. モジュールをパッケージ/ツールボックスに変えます
1. 便利なドキュメントを書く*

### ポータブルな推奨事項
1. それが住んでいた環境を再現できることを確認してください
1. 便利なドキュメントを書く*

### 拡張可能な推奨事項
1. 便利なドキュメントを書く*

### 変更可能な推奨事項
1. 人間がコードを読み取れるようにしてください
1. コメントがあることを確認してください
1. 便利なドキュメントを書く*

注意深い読者は、 `便利なドキュメント` があらゆるレベルの再利用について言及されていることに気づくかもしれません。 これは、異なるレベルの再利用に異なるレベルのドキュメントが必要であるためです。

### 異なるレベルの再利用に対する異なるドキュメントの要件
便利なドキュメントを書くことは、すべてのレベルの再利用にとって重要な要件です。 しかし、異なるレベルの再利用には、異なるドキュメント要件があります。

ドキュメント:
- 使用方法を説明します。
  - ソフトウェアが何をするか; (繰り返し可能にするために必要)
  - どのように使用することができるか; (再現可能にするために必要)
  - どのオプション/パラメータが利用可能か。 （繰り返し可能にするには必須）
- 実行方法の例が含まれています （繰り返し可能にするには必須）
- 以下の良い説明を含むインストール手順があります:
  - 依存するハードウェア（GPUsなど）。（ポータブルに必要）
  - ソフトウェアがテストされているオペレーティングシステム; (ポータブルに必要)
  - ソフトウェア要件(ライブラリやシェルの設定など)があります。 (ポータブルに必須)

(rr-code-reuse-recommendation-details)=
## Recommendations for reusable code
あなた(または他の誰か)が同じことをするためにコードを再利用できることを確認してください。
{ref}`rr-code-reuse-recommendation-checklist` には、ソフトウェアをより再利用可能にするためのおすすめのチェックリストが含まれています。 このセクションでは、このガイドの他の関連する部分へのポインタとともに、これらの推奨事項のそれぞれについて詳しく説明します。

### 繰り返し推奨事項
この段階では、コードを開いて読み取る必要もないかもしれません。 必要なすべてのステップを再実行し、あなたが持っていたのと同じ結果を得ることができるようにしたいだけです。

#### 1. 確認してください (スペースで)
コードは公開され、共同作業者と共有する必要があります。 誰もがそれを見つけてアクセスできるように、一意の永続的な識別子を持っています。

**See also**: {ref}`rr-vcs`

#### 2. 見つけられることを確認してください（時間内）
コードの時間的進化は、バージョン管理によって記述されているのが理想です。 これにより、過去から特定のバージョンを取得できます。

**See also**: {ref}`rr-vcs`

#### 3. 同じ一連の操作を実行できることを確認してください
多くの場合、環境を整える人間は、コードを書いた人であり、コードを再実行して結果を再現できるようにするために必要なステップの正確な順序を知っている人でもあります。 これは、別の人間がそれをやり直すために、きっと注意深く記録されるでしょう。

****: [再現可能な研究に関するCodeRefinery lesson](https://coderefinery.github.io/reproducible-research/)

#### 4. あなたの環境と一連の操作が堅牢であることを確認してください。何が行われたかを再現するために人間は必要ありません。
人間に頼りたくない。 悪意がなくても間違いを犯す傾向があります。 したがって、必要に応じて環境をスクリプト化して再作成し、すべてのステップを接着するパイプラインスクリプトによってオペレーションのシーケンスを実行させることを望んでいます。

****: {ref}`rr-renv-options` も参照してください。

#### 5. コードをライセンスしてください
あなたのコードにライセンスを添付し、人々がそれを再使用するときに引用する方法を指定してください。 再利用を可能にする許可ライセンスを使用することを検討してください。 また、ライブラリまたはソフトウェアのライセンスと互換性のあるライセンスを選択する必要があります。

**関連項目**: {ref}`rrr-licensing-Software`, {ref}`rr-licensing-software-permissive`, {ref}`rr-licensing-compatibility`

#### 6. 引用可能であることを確認してください
人々がそれを再使用するときに、あなたがどのように引用されるかを指定することを確認してください。

**関連項目**: {ref}`cm-citable-cite-software`

#### 7. 必要なデータを含める
ソフトウェアが任意の種類のデータに依存している場合、データが利用可能になるはずです。

****: {ref}`rr-rdm-data` も参照。

### 再実行可能な推奨事項
あなた(または他の人)があなたが行ったことを行うためにそれを再利用できることを確認してくださいが、異なるデータ/異なるパラメータを使用してください

#### 1. ハードコードされたビットを削除し、コードをモジュール化する
コードにハードコードされたデータや解析パラメータに固有の詳細が必要ではありません。 何かが再利用可能な関数になれば、それをハードコードされたパラメータから分離し、それを自身で何か(再利用可能な)ものに変えることができる。 モジュールを純粋にします: 同じ入力が与えられた場合、純粋な関数は常に同じ値を返します。

**See also**: [CodeRefinery Modular Code Development lesson](https://cicero.xyz/v3/remark/0.14.0/github.com/coderefinery/modular-code-development/master/talk.md/#1)

#### 2. 作成したモジュールは、さまざまな種類の入力データまたはパラメータを取ることができることをテストします
今後どのようにコードが再利用されるかまだわからないかもしれません。 しかしどのパラメータが許可されているかテストできれば 使用すべきでないことを防ぐことができます

****: [自動テストに関するCodeRefinery lesson](https://coderefinery.github.io/testing/motivation/)

#### 3. モジュールをパッケージ/ツールボックスに変えます
プロジェクトの詳細を、他のプロジェクトや他の人が再利用できるビットで区切ってください。

**See also**: {ref}`rr-renv-package`, [Packaging Software](https://scicomp.aalto.fi/scicomp/packaging-software/), [Software packaging in Python](https://aaltoscicomp.github.io/python-for-scicomp/packaging/)

### ポータブルな推奨事項
移植性とは、ソフトウェアを新しい環境に移行する能力を指します。 これは、同一の(同一ではない)マシンを指しますが、新しいハードウェアアーキテクチャ、オペレーティングシステムなどを参照することもできます。 これらはどちらもソフトウェアの再利用に重要です。

#### 1. それが住んでいた環境を再現できることを確認してください
環境は、静かにコードに付随する時間の脆弱なスナップショットです。 ソフトウェアを操作した人間、データを準備するために人間がおこなった手順を含むことができます。 ハードウェア、OS、ライブラリ、外部パッケージ/ツールボックス/依存関係。 このすべてが、別の人間が同じ全ての正確なステップをやり直すために、注意深く記録することができます。

****: {ref}`rr-renv` も参照。

### 拡張可能な、変更可能な推奨事項
他の人がコードを拡張して改善できるようにしてください。

#### 1. 人間がコードを読み取れるようにしてください
多くの場合、他の人のためのコードを書くことができるように、彼らはそれを(あなたの未来の自己を含む)読むことができます。 不明瞭な変数名を持つ不可解なonlinerは、1つのライナーを読みやすい変数名で複数のステップに分割するよりも速く、効率的ではありません。 さらに、コーディング規約を使用すると、他の読者に役立ちます。

**See also**: {ref}`rr-code-style-and formatting`, {ref}`rr-code-quality-利点`

#### 1. コメントがあることを確認してください
実際のコードを書く前にコメントを書く。 誰かがコメントを読んで、コメント間のコードビットをすべてスキップして、コード全体を読むように全体像を得ることができると想像してみてください。
